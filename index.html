<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stars for you</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon_io/star2.ico" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"
    />
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"
    ></script>
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <div id="panorama">
      <div id="controls">
        <div class="ctrl"><i class="fa-solid fa-circle-info"></i></div>
        <div class="info-backdrop"></div>
        <div class="poem-page">
          <button class="close-poem-page" aria-label="Close">×</button>
          <h2>My Star</h2>
          <p>
            My radiant beam in the night<br />
            Shining brighter than galaxies awake,<br />
            More beautiful than the moon in her full glory,<br />
            The most beautiful
          </p>
          <p>
            The void drags you in,<br />
            Tugs at you,<br />
            Tries to twist that radiance—<br />
            But no, you’re brighter, you’re stronger.
          </p>
          <p>
            Through storms of dust and time’s slow pull,<br />
            You burned unbroken,<br />
            And I learned to walk by your light<br />
            Even when my own sky had no dawn.
          </p>
          <p>
            This light made me strong,<br />
            Pulled me from my endless night,<br />
            Taught me that shadows fear persistence.
          </p>
          <p>
            This light, I won’t let dim.<br />
            The darkness, I’ll shoulder.<br />
            The void, I’ll fill.
          </p>
          <p>
            So, my star—<br />
            keep shining
          </p>
          <p>
            Even when distance swallows the sky,<br />
            Even when silence crowds my breath,<br />
            I’ll look upward,<br />
            And find you waiting.
          </p>
          <p>
            For as long as you burn,<br />
            Hope will have a name.<br />
            And I will whisper it—<br />
            My star.
          </p>
        </div>

        <div class="info-box">
          <!-- Disclaimer -->
          <div class="info-disclaimer">
            <strong>Disclaimer:</strong> Reloading will reset your progress.
          </div>

          <button class="close-btn" aria-label="Close">&times;</button>

          <!-- Guide -->
          <section class="info-section">
            <h2>Guide</h2>
            <p class="info-text">
              A poem drifts within the Milky Way’s heart, while the distant
              stars silent witnesses to your greatness — yours is the quest to
              bring them into the light.
            </p>
          </section>

          <!-- Progress -->
          <section class="info-section">
            <h2>Progress</h2>
            <p>
              Poem Stars — <span id="poem-stars-count">0/8</span>
              <button class="progress-chip is-locked" id="inliers">
                <svg
                  class="chip-icon"
                  viewBox="0 0 24 24"
                  width="14"
                  height="14"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="12" cy="12" r="3"></circle>
                  <path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7-10-7-10-7z"></path>
                </svg>
                
              </button>
            </p>
            <p>
              Outlier Stars — <span id="outlier-stars-count">0/20</span>
              <button class="progress-chip" id="outliers">
                <svg
                  class="chip-icon"
                  viewBox="0 0 24 24"
                  width="14"
                  height="14"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="12" cy="12" r="3"></circle>
                  <path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7-10-7-10-7z"></path>
                </svg>
                View
              </button>
            </p>
          </section>
        </div>
        <div class="poem-card">
          <button class="close-poem" aria-label="Close">×</button>
          <p class="poem"></p>
        </div>
      </div>
    </div>

    <script>
      viewer = pannellum.viewer("panorama", {
        type: "equirectangular",
        panorama: "images/eso0932a-2.jpg",
        autoLoad: true,
        preview: "images/download.jpg",
        showControls: false,
        // hotSpotDebug: true,
        hotSpots: [
          {
            pitch: -58.290315598256684,
            yaw: -68.8065313342274,
            cssClass: "custom-hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: "hello there",
          },
          {
            pitch: -31.4,
            yaw: 82,
            cssClass: "custom-hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: "haha another one",
          },
          {
            pitch: -16.4,
            yaw: -13.4,
            cssClass: "custom-hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: "test",
          },
          {
            pitch: -42.5,
            yaw: 59.7,
            cssClass: "custom-hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: "meow",
          },
          {
            pitch: 71.3,
            yaw: 118,
            cssClass: "custom-hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: "meow",
          },
          {
            pitch: 17,
            yaw: 54.2,
            cssClass: "custom-hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: "meow",
          },
          {
            pitch: -23.1,
            yaw: -117.6,
            cssClass: "custom-hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: "meow",
          },
          {
            pitch: -9.1,
            yaw: 135.7,
            cssClass: "custom-hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: "meow",
          },
          {
            pitch: -20.3,
            yaw: 153.6,
            cssClass: "custom-hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: "meow",
          },
          {
            pitch: -24.33,
            yaw: 101.24,
            cssClass: "custom-hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: "meow",
          },
          {
            pitch: 17.3,
            yaw: 11,
            cssClass: "custom-hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: "meow",
          },
          {
            pitch: -25.21,
            yaw: -163.64,
            cssClass: "custom-hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: "meow",
          },
          {
            pitch: -5.5,
            yaw: -131.5,
            cssClass: "custom-hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: "meow",
          },
          {
            pitch: 2.4,
            yaw: -13.8,
            cssClass: "custom-hotspot",
            createTooltipFunc: poemHotspot,
            createTooltipArgs: "My radiant beam...",
            scaleFactor: -2,
          },
          {
            pitch: 0.7,
            yaw: -2.85,
            cssClass: "custom-hotspot",
            createTooltipFunc: poemHotspot,
            createTooltipArgs: "This light made me strong...",
            scaleFactor: -2,
          },
          {
            pitch: 4.69,
            yaw: -6.8,
            cssClass: "custom-hotspot",
            createTooltipFunc: poemHotspot,
            createTooltipArgs: "Through storms...",
            scale: false,
          },
          {
            pitch: 1.24,
            yaw: 6.58,
            cssClass: "custom-hotspot",
            createTooltipFunc: poemHotspot,
            createTooltipArgs: "Even when...",
            scale: false,
          },
          {
            pitch: 0.87,
            yaw: -11.9,
            cssClass: "custom-hotspot",
            createTooltipFunc: poemHotspot,
            createTooltipArgs: "The void drags...",
            scale: false,
          },
          {
            pitch: 5.9,
            yaw: 2.4,
            cssClass: "custom-hotspot",
            createTooltipFunc: poemHotspot,
            createTooltipArgs: "So,",
            scale: false,
          },
          {
            pitch: -0.05,
            yaw: 11.4,
            cssClass: "custom-hotspot",
            createTooltipFunc: poemHotspot,
            createTooltipArgs: "For as long...",
            scale: false,
          },
          {
            pitch: 1.7,
            yaw: -3.8,
            cssClass: "custom-hotspot",
            createTooltipFunc: poemHotspot,
            createTooltipArgs: "This light, I won’t let dim...",
            scale: false,
          },
        ],
      });

      const poem = {
        "My radiant beam...": `My radiant beam in the night
        Shining brighter than galaxies awake,
        More beautiful than the moon in her full glory,
        The most beautiful`,

        "The void drags...": `The void drags you in,
        Tugs at you,
        Tries to twist that radiance—
        But no, you’re brighter, you’re stronger.`,

        "Through storms...": `Through storms of dust and time’s slow pull,
        You burned unbroken,
        And I learned to walk by your light
        Even when my own sky had no dawn.`,

        "This light made me strong...": `This light made me strong,
        Pulled me from my endless night,
        Taught me that shadows fear persistence.`,

        "This light, I won’t let dim...": `This light, I won’t let dim.
        The darkness, I’ll shoulder.
        The void, I’ll fill.`,

        "So,": `So, my star—
        keep shining.`,

        "Even when...": `Even when distance swallows the sky,
        Even when silence crowds my breath,
        I’ll look upward,
        And find you waiting.`,

        "For as long...": `For as long as you burn,
        Hope will have a name.
        And I will whisper it—
        My star.`,
      };

      // stars found tracking and recording

      var foundVersesList = [];

      function foundVerses(args) {
        found = document.querySelector("#poem-stars-count");
        if (!foundVersesList.includes(args)) {
          foundVersesList.push(args);
          found.textContent = foundVersesList.length + "/8";
          canView(foundVersesList);
        }
        console.log(foundVersesList);
      }

      // opening poem page

      function canView(foundVersesL) {
        poemViewButton = document.querySelector("#inliers");
        poemCloseButton = document.querySelector(".close-poem-page");
        if (foundVersesL.length == 8) {
          poemViewButton.classList.remove('is-locked');
          poemViewButton.classList.add('is-open');
          poemViewButton.addEventListener("click", () => {
            poemPage.classList.add("is-open");
            infoBox.classList.remove("is-open");
            backdrop.classList.remove("is-open");
          });
          poemCloseButton.addEventListener("click", () => {
            poemPage.classList.remove("is-open");
          });
        }
      }

      // Hot spot creation function (outlier)
      function hotspot(hotSpotDiv, args) {
        hotSpotDiv.classList.add("custom-tooltip");
        var span = document.createElement("span");
        span.innerHTML = args;
        hotSpotDiv.appendChild(span);
        requestAnimationFrame(() => {
          span.style.width = span.scrollWidth - 20 + "px";
          span.style.marginLeft =
            -(span.scrollWidth - hotSpotDiv.offsetWidth) / 2 + "px";
          span.style.marginTop = -span.scrollHeight - 10 + "px";
        });
      }

      // Poem Hot Spots (inliers)
      function poemHotspot(hotSpotDiv, args) {
        hotSpotDiv.classList.add("custom-tooltip");
        hotSpotDiv.classList.add("poem-hotspot");

        var span = document.createElement("span");
        span.innerHTML = args;
        hotSpotDiv.appendChild(span);
        requestAnimationFrame(() => {
          span.style.width = span.scrollWidth - 20 + "px";
          span.style.marginLeft =
            -(span.scrollWidth - hotSpotDiv.offsetWidth) / 2 + "px";
          span.style.marginTop = -span.scrollHeight - 10 + "px";
        });

        hotSpotDiv.addEventListener("click", (hotspot) => {
          const poemCard = document.querySelector(".poem-card");
          const closePoem = document.querySelector(".close-poem");
          const poemText = document.querySelector(".poem-card p");
          poemCard.classList.add("is-open");
          backdrop.classList.add("is-open");
          // close
          closePoem.addEventListener("click", () => {
            poemCard.classList.remove("is-open");
            backdrop.classList.remove("is-open");
          });
          foundVerses(args);
          // show verse
          poemText.textContent = poem[args];
        });
      }

      // info box
      const infoBox = document.querySelector(".info-box");
      const backdrop = document.querySelector(".info-backdrop");
      const infoBtn = document.querySelector(".ctrl");
      const closeBtn = document.querySelector(".close-btn");
      const poemPage = document.querySelector(".poem-page");

      infoBtn.addEventListener("click", () => {
        infoBox.classList.add("is-open");
        backdrop.classList.add("is-open");
      });

      window.onload = (event) => {
        infoBox.classList.add("is-open");
        backdrop.classList.add("is-open");
      };

      closeBtn.addEventListener("click", () => {
        infoBox.classList.remove("is-open");
        backdrop.classList.remove("is-open");
      });

      backdrop.addEventListener("click", () => {
        infoBox.classList.remove("is-open");
        backdrop.classList.remove("is-open");
      });

      // scaling (THIS WAS A F'IN FAILURE)
      // viewer.on('zoomchange', function(e) {
      //   document.querySelectorAll('.custom-hotspot').forEach(el => {
      //     // 50, 120

      //   });
      // });
      // function hotspotResize(hotspots) {
      //   console.log('meow')
      //   hotspots.forEach(hotspot => {
      //     console.log(hotspot.style.width)
      //   });
      // }
    </script>
  </body>
</html>
